{"id":"orders","metainfo":{"label":"orders","autoLayout":true,"staleState":"none","sourceSuggestions":{"sources":[]},"graphConfig":{"modelConfig":{"materialized":"incremental","alias":"orders","tags":["\"orders_snapshots\""]},"userDefinedConfig":{"vars":{"payment_methods":"['credit_card', 'coupon', 'bank_transfer', 'gift_card']","payments_dict":"{ 'credit' : 'card10', 'bank' : 'transfer11' }"}}}},"processes":{"payments##OztKIT9V":{"id":"payments##OztKIT9V","component":"Model","metadata":{"label":"payments","phase":0},"properties":{"table":{"name":"stg_payments","sourceType":"Model"}},"ports":{"inputs":[],"outputs":[{"id":"TqbVVyUw","schema":{"providerType":"BigQuery","fields":[{"name":"payment_id","dataType":{"type":"Integer"}},{"name":"order_id","dataType":{"type":"Integer"}},{"name":"payment_method","dataType":{"type":"String"}},{"name":"amount","dataType":{"type":"Float"}}]},"slug":"out"}],"isCustomOutputSchema":false}},"orders##s5iyV53x":{"id":"orders##s5iyV53x","component":"Model","metadata":{"label":"orders","phase":0},"properties":{"table":{"name":"stg_orders","sourceType":"Model"}},"ports":{"inputs":[],"outputs":[{"id":"e3Mk2ktI","schema":{"providerType":"BigQuery","fields":[{"name":"order_id","dataType":{"type":"Integer"}},{"name":"customer_id","dataType":{"type":"Integer"}},{"name":"order_date","dataType":{"type":"Date"}},{"name":"status","dataType":{"type":"String"}}]},"slug":"out"}],"isCustomOutputSchema":false}},"orders##mvvyWZGw":{"id":"orders##mvvyWZGw","component":"TargetModel","metadata":{"label":"orders","phase":0,"macroDependencies":[]},"properties":{"customQueryDisabled":true,"customQuery":false,"incrementalEditorDisabled":true,"query":"SELECT * \n\nFROM final\n","incrementalKey":false,"incremental":{"expression":"true"}},"ports":{"inputs":[{"id":"UTIi21Mf","schema":{"providerType":"BigQuery","fields":[{"name":"order_id","dataType":{"type":"Integer"}},{"name":"customer_id","dataType":{"type":"Integer"}},{"name":"order_date","dataType":{"type":"Date"}},{"name":"status","dataType":{"type":"String"}},{"name":"credit_card_amount","dataType":{"type":"Float"}},{"name":"coupon_amount","dataType":{"type":"Float"}},{"name":"bank_transfer_amount","dataType":{"type":"Float"}},{"name":"gift_card_amount","dataType":{"type":"Float"}},{"name":"amount","dataType":{"type":"Float"}}]},"slug":"final"}],"outputs":[{"id":"ffRhJTMi","schema":{"providerType":"BigQuery","fields":[{"name":"order_id","dataType":{"type":"Integer"}},{"name":"customer_id","dataType":{"type":"Integer"}},{"name":"order_date","dataType":{"type":"Date"}},{"name":"status","dataType":{"type":"String"}},{"name":"credit_card_amount","dataType":{"type":"Float"}},{"name":"coupon_amount","dataType":{"type":"Float"}},{"name":"bank_transfer_amount","dataType":{"type":"Float"}},{"name":"gift_card_amount","dataType":{"type":"Float"}},{"name":"amount","dataType":{"type":"Float"}}]},"slug":"out"}],"isCustomOutputSchema":false}},"final##v9EQsbFB":{"id":"final##v9EQsbFB","component":"Join","metadata":{"label":"final","phase":0,"macroDependencies":[]},"properties":{"conditions":[{"alias":"order_payments","expression":{"expression":"orders.order_id = order_payments.order_id"},"joinType":"LEFT"}],"expressions":[{"expression":{"expression":"orders.order_id"}},{"expression":{"expression":"orders.customer_id"}},{"expression":{"expression":"orders.order_date"}},{"expression":{"expression":"orders.status"}},{"rowType":"for","variable":{"expression":"payment_method"},"iterable":{"expression":"payment_methods"},"children":[{"expression":{"expression":"order_payments.{{payment_method}}_amount"}}]},{"expression":{"expression":"order_payments.total_amount"},"alias":"amount"}],"activeTab":"conditions","columnsSelector":[],"headAlias":"orders"},"ports":{"inputs":[{"id":"QMt37igC","schema":{"providerType":"BigQuery","fields":[{"name":"order_id","dataType":{"type":"Integer"}},{"name":"customer_id","dataType":{"type":"Integer"}},{"name":"order_date","dataType":{"type":"Date"}},{"name":"status","dataType":{"type":"String"}}]},"slug":"orders"},{"id":"B7uu8uJ2","schema":{"providerType":"BigQuery","fields":[{"name":"order_id","dataType":{"type":"Integer"}},{"name":"credit_card_amount","dataType":{"type":"Float"}},{"name":"coupon_amount","dataType":{"type":"Float"}},{"name":"bank_transfer_amount","dataType":{"type":"Float"}},{"name":"gift_card_amount","dataType":{"type":"Float"}},{"name":"total_amount","dataType":{"type":"Float"}}]},"slug":"order_payments"}],"outputs":[{"id":"tOVzdy0A","schema":{"providerType":"BigQuery","fields":[{"name":"order_id","dataType":{"type":"Integer"}},{"name":"customer_id","dataType":{"type":"Integer"}},{"name":"order_date","dataType":{"type":"Date"}},{"name":"status","dataType":{"type":"String"}},{"name":"credit_card_amount","dataType":{"type":"Float"}},{"name":"coupon_amount","dataType":{"type":"Float"}},{"name":"bank_transfer_amount","dataType":{"type":"Float"}},{"name":"gift_card_amount","dataType":{"type":"Float"}},{"name":"amount","dataType":{"type":"Float"}}]},"slug":"out"}],"isCustomOutputSchema":false}},"order_payments##EVU2hiQY":{"id":"order_payments##EVU2hiQY","component":"Aggregate","metadata":{"label":"order_payments","phase":0,"macroDependencies":[]},"properties":{"aggregate":[{"expression":{"expression":"order_id"}},{"rowType":"for","variable":{"expression":"payment_method"},"iterable":{"expression":"payment_methods"},"children":[{"expression":{"expression":"sum(CASE\n  WHEN payment_method = '{{ payment_method }}'\n    THEN amount\n  ELSE 0\nEND)"},"alias":"{{payment_method}}_amount"}]},{"expression":{"expression":"sum(amount)"},"alias":"total_amount"}],"allowSelection":true,"condition":{"expression":""},"activeTab":"aggregate","columnsSelector":[],"groupBy":[{"expression":{"expression":"order_id"}}]},"ports":{"inputs":[{"id":"ozFHc8Cu","schema":{"providerType":"BigQuery","fields":[{"name":"payment_id","dataType":{"type":"Integer"}},{"name":"order_id","dataType":{"type":"Integer"}},{"name":"payment_method","dataType":{"type":"String"}},{"name":"amount","dataType":{"type":"Float"}}]},"slug":"payments"}],"outputs":[{"id":"Kb5TEWFL","schema":{"providerType":"BigQuery","fields":[{"name":"order_id","dataType":{"type":"Integer"}},{"name":"credit_card_amount","dataType":{"type":"Float"}},{"name":"coupon_amount","dataType":{"type":"Float"}},{"name":"bank_transfer_amount","dataType":{"type":"Float"}},{"name":"gift_card_amount","dataType":{"type":"Float"}},{"name":"total_amount","dataType":{"type":"Float"}}]},"slug":"out"}],"isCustomOutputSchema":false}}},"connections":[{"id":"eHC6R1GM","source":"payments##OztKIT9V","sourcePort":"TqbVVyUw","target":"order_payments##EVU2hiQY","targetPort":"ozFHc8Cu"},{"id":"CMC503dr","source":"orders##s5iyV53x","sourcePort":"e3Mk2ktI","target":"final##v9EQsbFB","targetPort":"QMt37igC"},{"id":"j4iSeUUN","source":"order_payments##EVU2hiQY","sourcePort":"Kb5TEWFL","target":"final##v9EQsbFB","targetPort":"B7uu8uJ2"},{"id":"sOWmyyH7","source":"final##v9EQsbFB","sourcePort":"tOVzdy0A","target":"orders##mvvyWZGw","targetPort":"UTIi21Mf"}],"component":"Model"}